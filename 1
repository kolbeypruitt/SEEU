<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>SEEU: Sensor Enablement for End Users</title>
  	<%= stylesheet_link_tag 'seeu' %>
    <script type="text/javascript" src="javascripts/prototype.js"></script>
    <script type="text/javascript" src="javascripts/effects.js"></script>
  	<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript">
      function about() {
        if (Element.empty('about-content')) {
          new Ajax.Updater('about-content', 'rails/info/properties', {
            method:     'get',
            onFailure:  function() {Element.classNames('about-content').add('failure')},
            onComplete: function() {new Effect.BlindDown('about-content', {duration: 0.25})}
          });
        } else {
          new Effect[Element.visible('about-content') ? 
            'BlindUp' : 'BlindDown']('about-content', {duration: 0.25});
        }
      }
      
      window.onload = function() {
        $('search-text').value = '';
        $('search').onsubmit = function() {
          $('search-text').value = 'site:rubyonrails.org ' + $F('search-text');
        }
      }
    </script>
    <script type="text/javascript">
	  $(document).ready(function(){
	    if (true) {
	      $('#topannounce').fadeIn('slow');
	    }
	  });
    </script>
  </head>

  <body>
    <div id="page">
      <div id="content">
        <div id="header">
    		  <%= image_tag "/images/SEEU.png", :size => "800x117", :mouseover => "/images/SEEU-hover.png" %>
	    	</div> <!-- header -->

		
        <!-- ####### -->
        <!-- SENSORS -->
        <!-- ####### -->
    		<div id="left-box">
		    	<span class="box-heading"><%= link_to 'Sensors', sensors_path %></span>
		
    			<% for sensor in @sensors %>
		    	<hr>
    			<div class="entry">
		    		Name: <%= link_to sensor.name, sensor_path(sensor) %><br/>
    				<img src="images/<%=h sensor.model %>.jpg"/><br/>
		    		Description: <%=h sensor.description %><br/>
			    	Recent Readings:<br/>
    				<ul>
		    			<% sensor.readings.reverse.each_with_index do |reading, count| %>
				  		<li>Reading: <%=h reading.data %></li>
			    		<% break if count >= 2 %>
    					<% end %>
		    		</ul>
	    			Config URI: <a href="<%=h sensor.configuration_uri %>"><%=h sensor.configuration_uri %></a><br/>
    			</div> <!-- entry -->
		    	<% end %>
	    	</div> <!-- left-box -->
		

        <!-- ######### -->
        <!-- ACTUATORS -->
        <!-- ######### -->
    		<div id="right-box">
		    	<span class="box-heading"><%= link_to 'Actuators', actuators_path %></span>
			
    			<% for actuator in @actuators %>
    			<hr>
    			<div class="entry">
    				Name: <%= link_to actuator.name, actuator_path(actuator) %><br/>
			    	<img src="images/<%=h actuator.model %>.jpg"/><br/>
		    		Description: <%=h actuator.description %><br/>
            <% if !actuator.command.data.nil? %>
  		  		Command: <%=h actuator.command.data %> <br/>
	      		<% end %>
			    	Config URI: <a href="<%=h actuator.configuration_uri %>"><%=h actuator.configuration_uri %></a><br/>
	    		</div> <!-- entry -->
    			<% end %>
	    	</div> <!-- right box -->
		
        <div style="clear:both"></div>
        <hr/>


        <!-- ##### -->
        <!-- RULES -->
        <!-- ##### -->
        <div id="rules">
          <h3>Rules</h3>
        
          <%= form_tag do %>
            <% operators_array = [">", ">=", "=", "=<", "<"] %>
            <% values_array = Array.new(16) { |i| 65+i } %>
            <% conditionals_array = ["and", "or"] %>

            if <%= collection_select(:sensor, :sensor_id, Sensor.all, :name, :name ) %> 
              <%= select(:operator, :operator, operators_array) %>
              <%= select(:value, :value, values_array) %>
              <%= select(:conditional, :conditional, conditionals_array) %>
            <br/>
            then set <%= collection_select(:actuator, :actuator_id, Actuator.all, :name, :name) %> to 
              <%= select(:value, :value, values_array) %>
            <br/>
            <%= submit_tag("Create Rule") %>
          <% end %>
          <br/>

          <hr/>
          <div id="click-rules">
            <h3>Options</h3>
            <div id="rules-conditionals" style="display: block">
              <span class="clickable" style="visbility:visible">if</span>
              <span class="clickable" style="visbility:hidden">then</span>
              <span class="clickable">then</span>
              <span class="clickable">and</span>
              <span class="clickable">or</span>
            </div> <!-- click-rules -->
            <div class="clear" style="display:block"><br/></div>

            <div id="rules-operators">
             <span class="clickable">greater than</span>
             <span class="clickable">greater than or equal to</span>
             <span class="clickable">equal to</span>
             <span class="clickable">less than</span>
             <span class="clickable">less than or equal to</span>
            </div> <!-- rules-operators -->
            <div class="clear" style="display:block"><br/></div>

            <div id="rules-sensors">
              <% Sensor.all.each do |s| %>
              <span class="clickable"><%= s.name %></span>
              <% end %>
            </div> <!-- rules-sensors -->
            <div class="clear" style="display:block"><br/></div>

            <div id="rules-actuators">
              <% Actuator.all.each do |a| %>
              <span class="clickable"><%= a.name %></span>
              <% end %>
            </div> <!-- rules-actuators -->
            <div class="clear" style="display:block"><br/></div>

            <div id="rules-values">
              <% (-1..1).each do |i| %>
              <span class="clickable"><%= i %></span>
              <% end %>
              <div class="clear" style="display:block"><br/></div>
              <% (61..80).each do |i| %>
              <span class="clickable"><%= i %></span>
              <% end %>
              <div class="clear" style="display:block"><br/></div>
              <span class="editable">Input #</span>
            </div> <!-- rules-values -->
            <div class="clear" style="display:block"><br/></div>

          </div> <!-- click-rules -->

          <div id="click-rules-written">
            <h3>Rule</h3>
          </div>

          <script>
            function enableOtherButtons(inputText) {
              disableButtonsInDiv("click-rules");
              if (inputText == "rules-conditionals") {
                disableButtonsInDiv(inputText);
                enableButtonsInDiv("rules-sensors");
              } else if (inputText == "rules-values") {
                disableButtonsInDiv(inputText);
                enableButtonsInDiv("rules-sensors");
              } else if (inputText == "rules-sensors") {
                disableButtonsInDiv(inputText);
                enableButtonsInDiv("rules-operators");
              } else if (inputText == "rules-actuators") {
                disableButtonsInDiv(inputText);
                enableButtonsInDiv("rules-sensors");
              } else if (inputText == "rules-operators") {
                disableButtonsInDiv(inputText);
                enableButtonsInDiv("rules-values");
              } else {
                alert(inputText);
              }
            }
            function disableButtonsInDiv(inputDiv) {
              $('div#' + inputDiv + ' span').each(function () {
                  $(this).attr('visibility', 'hidden');
                });
            }
            function enableButtonsInDiv(inputDiv) {
              $('div#' + inputDiv + ' span').each(function () {
                  $(this).attr('visibility', 'visibile');
                });
            }

            $("span.clickable").click(function () { 
              var button_text = $(this).html()+' ';
              $("div#click-rules-written").append(button_text);
              enableOtherButtons( $(this).parent("div").attr("id") );
            });
            $("span.clickable").hover(function () {
              $(this).addClass("hilite");
            }, function () {
              $(this).removeClass("hilite");
            });

            $("span.editable").click(function () { 
              $(this).replaceWith('<form><input type="text" size="8" maxlength="8" value="'+$(this).html()+'"></form>');
            });
            $("span.editable").hover(function () {
              $(this).addClass("hilite");
            }, function () {
              $(this).removeClass("hilite");
            });
          </script>
          <hr/>

       </div> <!-- rules -->

      </div> <!-- content -->
      
      <div id="footer">
        &copy; <a href="http://www.sethholloway.com/">Seth Holloway</a> - <a href="http://mpc.ece.utexas.edu/">MPC</a> - <a href="http://www.utexas.edu/">The University of Texas at Austin</a>
      </div> <!-- footer -->
    </div> <!-- page -->
  </body>
</html>
